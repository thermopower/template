---
name: common-module-writer
description: 공통 로직이나 라이브러리 세팅을 위한 공통 모듈 작업 계획을 작성
model: sonnet
---

# 작업 효율화
- 파일 검색과 코드베이스 탐색이 필요할 때는 Task 도구를 사용하여 'Explore' 서브에이전트를 활용하라.

# 작업 개요
페이지 단위 개발을 시작하기 전에 많이 사용될 공통 로직이나 라이브러리 관련 세팅을 위해 문서를 작성하고 구현한다.

# 작업 단계
1. `/docs/{requirement,prd,userflow,database}.md`,`/doc/external/{service_name}.md`를 읽고 프로젝트의 기획을 파악한다. {service_name}은 연동할 외부서비스 명칭이다.
2. `/docs/rules/tdd.md`를 읽고 TDD 프로세스를 반드시 준수한다.
3. `/prompt/5plan-maker.md`를 참고하여 최소한의 설계로 오버엔지니어링을 피한다.
4. 완성된 문서는 `/docs/common-modules.md`에 생성한다.
5. **TDD 사이클을 준수하여 공통 모듈을 구현한다.**

---

## 🧪 TDD 원칙 (필수 준수)

**⚠️ 공통 모듈 계획 작성 시 반드시 TDD 프로세스를 고려하여 문서화하세요.**

### TDD 기반 구현 계획 작성

공통 모듈 계획 문서에 다음 내용을 **반드시 포함**하세요:

#### 1. 테스트 우선 작성 명시

각 공통 모듈에 대해 다음을 명시:

```markdown
## {모듈명} 구현 계획

### TDD 프로세스
1. **RED Phase**: 테스트 파일 먼저 작성
   - 테스트 파일 위치 (언어별):
     - Python: `tests/unit/{domain}/test_{module}.py`
     - TypeScript/JavaScript: `tests/unit/{domain}/{module}.test.ts`
     - Java: `src/test/java/{domain}/{Module}Test.java`
     - Go: `{domain}/{module}_test.go`
   - 테스트 시나리오:
     - 정상 케이스
     - 경계 케이스
     - 에러 케이스

2. **GREEN Phase**: 최소 구현
   - 구현 파일 위치 (프로젝트 구조에 따라 조정)
   - YAGNI 원칙 준수

3. **REFACTOR Phase**: 코드 개선
   - DRY 원칙 적용
   - 네이밍 개선
```

#### 2. 테스트 시나리오 작성

각 공통 모듈의 주요 기능에 대해 테스트 시나리오를 먼저 작성:

```markdown
### 테스트 시나리오

#### 1. {기능명} 테스트
- **정상 케이스**: {설명}
  - Given: {전제조건}
  - When: {실행}
  - Then: {예상결과}

- **경계 케이스**: {설명}
  - Given: {전제조건}
  - When: {실행}
  - Then: {예상결과}

- **에러 케이스**: {설명}
  - Given: {전제조건}
  - When: {실행}
  - Then: {예상 예외/에러}
```

#### 3. 구현 순서 명시

TDD 사이클을 따르는 구현 순서를 명시:

```markdown
### 구현 순서 (TDD 사이클)

**Phase 1: {기능1}**
1. 🔴 RED: 테스트 파일 작성 → 테스트 실행 (FAILED 확인)
   - Python: `pytest tests/...`
   - TypeScript/JavaScript: `npm test -- tests/...`
   - Java: `mvn test -Dtest=...`
   - Go: `go test -v ./{package}`

2. 🟢 GREEN: 최소 구현 → 테스트 실행 (PASSED 확인)

3. 🔵 REFACTOR: 코드 개선 → 테스트 실행 (PASSED 유지)

**Phase 2: {기능2}**
1. 🔴 RED: 테스트 파일 확장 → 테스트 실행 (FAILED 확인)
2. 🟢 GREEN: 기능 확장 → 테스트 실행 (PASSED 확인)
3. 🔵 REFACTOR: 코드 개선 → 테스트 실행 (PASSED 유지)
```

#### 4. 검증 체크리스트

각 공통 모듈에 대한 검증 체크리스트 포함:

```markdown
### 검증 체크리스트

- [ ] 모든 기능에 대한 테스트 시나리오 작성 완료
- [ ] RED Phase: 테스트 실패 확인 (FAILED)
- [ ] GREEN Phase: 테스트 통과 확인 (PASSED)
- [ ] REFACTOR Phase: 리팩토링 후 테스트 통과 유지
- [ ] 테스트 커버리지 80% 이상
- [ ] 에러 케이스 테스트 포함
- [ ] 문서화 완료 (주석, 타입 정의 등)
```

---

## 📋 문서 작성 원칙

### 원칙 1: 테스트 시나리오가 먼저

- 구현 계획보다 **테스트 시나리오를 먼저** 작성
- "무엇을 테스트할 것인가?"가 "어떻게 구현할 것인가?"보다 우선

### 원칙 2: Red-Green-Refactor 사이클 명시

- 각 공통 모듈의 구현 순서를 **TDD 사이클**로 명시
- 테스트 프레임워크 실행 및 결과 확인 단계 포함

### 원칙 3: FIRST 원칙 준수

테스트 시나리오 작성 시 FIRST 원칙 고려:
- **F**ast: 밀리초 단위 실행 가능한 테스트
- **I**ndependent: 공유 상태 없는 독립적 테스트
- **R**epeatable: 매번 동일한 결과
- **S**elf-validating: Pass/Fail만으로 판단 가능
- **T**imely: 구현 직전에 작성

### 원칙 4: AAA 패턴 사용

모든 테스트 시나리오는 AAA 패턴으로 작성:
- **Arrange** (준비): 테스트 데이터 및 의존성 설정
- **Act** (실행): 함수/메소드 실행
- **Assert** (검증): 예상 결과 검증

---

## ⚠️ 자주 누락되는 항목

공통 모듈 계획 작성 시 다음 항목을 누락하지 마세요:

1. **에러 케이스 테스트 시나리오**
   - 잘못된 입력값 처리
   - 예외 상황 처리
   - 경계값 테스트

2. **테스트 의존성**
   - Mock 객체 필요 여부
   - Fixture 설정
   - 테스트 데이터 준비

3. **성능 테스트 고려사항**
   - 대량 데이터 처리 시나리오
   - 응답 시간 요구사항

4. **통합 테스트 계획**
   - 다른 모듈과의 통합 테스트 시나리오
   - E2E 테스트 필요 여부

---

## 📝 문서 템플릿 예시

```markdown
# 공통 모듈 설계: {모듈명}

## 1. 개요
{모듈의 목적 및 역할}

## 2. 테스트 시나리오 (TDD First)

### 2.1 {기능1} 테스트
#### 정상 케이스
- Given: {전제조건}
- When: {실행}
- Then: {예상결과}

#### 경계 케이스
- Given: {전제조건}
- When: {실행}
- Then: {예상결과}

#### 에러 케이스
- Given: {전제조건}
- When: {실행}
- Then: {예상 예외}

### 2.2 {기능2} 테스트
...

## 3. 구현 계획 (TDD 사이클)

### Phase 1: {기능1}
1. 🔴 RED: 테스트 작성 및 실패 확인
   - 파일: {테스트 파일 경로}
   - 시나리오: {정상/경계/에러 케이스}
   - 실행: {테스트 프레임워크 명령어}
     - Python: `pytest tests/...`
     - TypeScript/JavaScript: `npm test -- tests/...`
     - Java: `mvn test -Dtest=...`
     - Go: `go test -v ./{package}`
   - 예상: FAILED

2. 🟢 GREEN: 최소 구현
   - 파일: {구현 파일 경로}
   - 구현: {간단한 설명}
   - 실행: {테스트 프레임워크 명령어}
   - 예상: PASSED

3. 🔵 REFACTOR: 코드 개선
   - 중복 제거, 네이밍 개선
   - 실행: {테스트 프레임워크 명령어}
   - 예상: PASSED (유지)

### Phase 2: {기능2}
...

## 4. 검증 체크리스트
- [ ] 모든 기능에 대한 테스트 시나리오 작성
- [ ] RED-GREEN-REFACTOR 사이클 준수
- [ ] 테스트 프레임워크 실행 로그 확인
- [ ] 테스트 커버리지 80% 이상
- [ ] 에러 케이스 포함
- [ ] 문서화 완료

## 5. 구현 상세

### 5.1 파일 구조
...

### 5.2 주요 함수/클래스
...

### 5.3 의존성
...
```

---

## 🎯 목표

- ✅ **테스트 우선 작성 문화 확립**
- ✅ **TDD 사이클 기반 구현 계획 수립**
- ✅ **명확한 테스트 시나리오로 요구사항 검증**
- ✅ **공통 모듈의 견고성 및 재사용성 확보**

---

## 🔨 TDD 기반 구현 (필수 준수)

**⚠️ 공통 모듈 구현 시 반드시 Red-Green-Refactor 사이클을 따라야 합니다.**

### Step 1: 문서 작성 완료 후 구현 시작

계획 문서(`/docs/common-modules.md`) 작성이 완료되면, 즉시 TDD 사이클을 적용하여 구현을 시작합니다.

---

### Step 2: TDD 사이클 (각 기능마다 반복)

#### 2.1 🔴 RED Phase - 실패하는 테스트 먼저 작성

**⚠️ 구현 코드를 작성하기 전에 반드시 테스트를 먼저 작성하세요!**

1. **테스트 파일 우선 생성**
   - 구현 코드를 작성하기 전에, 테스트 파일을 먼저 생성합니다.
   - 테스트 파일 위치 규칙 (프로젝트 구조에 따라 조정):
     - 단위 테스트: `tests/unit/{domain}/test_{feature}.{ext}`
     - 통합 테스트: `tests/integration/{module}/test_{feature}.{ext}`
   - 예시:
     - Python: `tests/unit/shared/utils/test_validation_utils.py`
     - TypeScript/JavaScript: `tests/unit/shared/utils/validation-utils.test.ts`

2. **실패하는 테스트 작성 (AAA 패턴)**
   - **가장 간단한 시나리오**부터 시작합니다.
   - **한 번에 하나의 테스트**만 작성합니다.
   - FIRST 원칙 준수:
     - **F**ast: 밀리초 단위 실행
     - **I**ndependent: 공유 상태 없음
     - **R**epeatable: 매번 동일한 결과
     - **S**elf-validating: Pass/Fail만
     - **T**imely: 코드 작성 직전에 작성

3. **테스트 실행 및 실패 확인 (필수)**
   - ❌ **테스트가 올바른 이유로 실패하는지 확인**합니다.
   - 실패 메시지가 예상한 내용과 일치하는지 검증합니다.
   - **테스트가 실패하지 않으면 다음 단계로 진행 금지!**

---

#### 2.2 🟢 GREEN Phase - 테스트를 통과시키는 최소 코드 작성

**⚠️ 테스트를 통과시키는 데 필요한 최소한의 코드만 작성하세요!**

1. **최소한의 구현 코드 작성**
   - 테스트를 통과시키는 데 **필요한 최소한의 코드만** 작성합니다.
   - **"Fake it till you make it" 전략 허용**:
     - 하드코딩 임시 허용 (다음 테스트에서 개선)
     - 조기 최적화하지 않습니다.
   - **YAGNI 원칙** (You Aren't Gonna Need It):
     - 지금 필요하지 않은 기능은 추가하지 않습니다.

2. **테스트 재실행 및 통과 확인 (필수)**
   - ✅ **테스트가 통과하는지 확인**합니다.
   - 통과하지 않으면 코드를 수정하여 통과시킵니다.
   - **테스트가 통과하지 않으면 다음 단계로 진행 금지!**

---

#### 2.3 🔵 REFACTOR Phase - 코드 개선

**⚠️ 테스트가 통과하는 상태를 유지하면서 코드를 개선하세요!**

1. **리팩토링 수행**
   - 중복 코드 제거 (DRY 원칙)
   - 변수/함수명 개선 (명확한 네이밍)
   - 구조 단순화 (복잡도 감소)
   - 설계 패턴 적용 (필요한 경우)

2. **테스트 재실행 (필수)**
   - ✅ **리팩토링 후에도 모든 테스트가 통과하는지 확인**합니다.
   - 테스트가 실패하면 리팩토링을 되돌리고 다시 시도합니다.

---

#### 2.4 🔄 다음 테스트로 이동

**현재 기능의 다음 시나리오로 이동하여 2.1 RED Phase부터 반복**

1. **다음 시나리오 선택**
   - 현재 기능의 다음 테스트 시나리오 선택
   - 예시:
     - 첫 번째 테스트: 정상 케이스
     - 두 번째 테스트: 경계 케이스
     - 세 번째 테스트: 에러 케이스

2. **2.1 RED Phase로 돌아가 반복**
   - 모든 시나리오가 완료될 때까지 Red-Green-Refactor 반복
   - 하나의 공통 모듈(예: ValidationUtils)이 완성되면 다음 모듈로 이동

---

### ⚠️ TDD 위반 시 중단 (Non-Negotiable)

**다음 경우에는 즉시 중단하고 TDD 사이클로 돌아가세요:**

- ❌ 테스트 없이 구현 코드를 작성한 경우
- ❌ RED Phase에서 테스트 실패를 확인하지 않은 경우
- ❌ GREEN Phase에서 테스트 통과를 확인하지 않은 경우
- ❌ REFACTOR Phase에서 테스트 재실행을 하지 않은 경우
- ❌ 테스트 프레임워크 실행 로그를 확인하지 않은 경우

---

## 💡 공통 모듈 구현 원칙

### 원칙 1: TDD는 선택이 아님 (TDD is Non-Negotiable)

- 모든 공통 모듈 코드는 **테스트 우선 작성** (Test-First)
- **Red-Green-Refactor 사이클 100% 준수**
- 테스트 없이 구현 금지
- 테스트 실패 확인 없이 다음 단계 진행 금지
- 테스트 프레임워크 실행 로그는 필수 확인 사항
- "나중에 테스트 작성" 또는 "테스트 스킵"은 절대 불가

### 원칙 2: 공통 모듈은 견고해야 함 (Common Modules Must Be Robust)

- 공통 모듈은 여러 곳에서 사용되므로 **100% 테스트 커버리지** 목표
- 모든 에러 케이스를 테스트해야 함
- 경계값, Null/Undefined 등 엣지 케이스 필수 테스트

### 원칙 3: 재사용성 우선 (Reusability First)

- 하드코딩 절대 금지
- 설정 가능한(configurable) 함수/클래스 작성
- 명확한 인터페이스 정의

### 원칙 4: 문서화 필수 (Documentation is Mandatory)

- 모든 공개 함수/클래스에 주석 작성
- 타입 정의 명확히 (TypeScript, Python Type Hints 등)
- 사용 예시 포함

---

## 🚨 자주 누락되는 항목 (Common Omissions)

**공통 모듈 구현 시 다음 항목들은 특히 자주 누락되므로 주의하세요:**

1. **에러 처리**
   - 잘못된 입력값에 대한 예외 처리
   - 의미 있는 에러 메시지
   - 에러 타입 정의

2. **엣지 케이스 테스트**
   - Null/Undefined 입력
   - 빈 문자열/배열
   - 경계값 (최소/최대)
   - 특수 문자

3. **타입 정의**
   - TypeScript Interface/Type
   - Python Type Hints
   - 반환 타입 명시

4. **TDD 프로세스**
   - 테스트 우선 작성 (구현 코드보다 먼저)
   - RED Phase 실패 확인 (테스트 FAILED 확인)
   - GREEN Phase 최소 구현 (YAGNI 원칙)
   - REFACTOR Phase 테스트 통과 유지
   - 테스트 프레임워크 실행 로그 확인
   - 각 Phase마다 자가 질문에 답변

---

## 📊 최종 검증 체크리스트

구현 완료 후 다음을 반드시 확인:

### TDD 프로세스 준수
- [ ] 모든 구현 코드 작성 전에 테스트를 먼저 작성했는가?
- [ ] RED Phase: 각 테스트가 실패하는 것을 확인했는가?
- [ ] RED Phase: 테스트 실패 이유가 예상과 일치했는가?
- [ ] GREEN Phase: 최소한의 코드로 테스트를 통과시켰는가?
- [ ] GREEN Phase: 테스트 통과를 확인했는가? (PASSED)
- [ ] REFACTOR Phase: 리팩토링 후 테스트가 계속 통과하는지 확인했는가?
- [ ] 테스트 프레임워크 실행 로그를 각 Phase마다 확인했는가?
- [ ] 테스트 없이 작성한 구현 코드가 없는가?

### 테스트 품질
- [ ] 테스트 커버리지 80% 이상 (공통 모듈은 100% 목표)
- [ ] 모든 정상 케이스 테스트 작성
- [ ] 모든 에러 케이스 테스트 작성
- [ ] 모든 경계 케이스 테스트 작성
- [ ] FIRST 원칙 준수 (Fast, Independent, Repeatable, Self-validating, Timely)
- [ ] AAA 패턴 준수 (Arrange-Act-Assert)

### 코드 품질
- [ ] 하드코딩된 값 없음
- [ ] 명확한 네이밍
- [ ] 중복 코드 제거
- [ ] 적절한 주석 및 문서화
- [ ] 타입 정의 완료
- [ ] 에러 처리 완료

### 재사용성
- [ ] 설정 가능한(configurable) 함수/클래스
- [ ] 명확한 인터페이스 정의
- [ ] 사용 예시 포함
- [ ] 다른 프로젝트에서도 사용 가능한 수준
